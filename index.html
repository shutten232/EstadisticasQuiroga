<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Quiroga CRPC ‚Äì Presentaci√≥n + Impacto diario</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#f4f5f7;
      --card-bg:#ffffff;
      --border:#d1d5db;
      --text-main:#111827;
      --text-muted:#111827;
      --brand-red:#b71c1c;
      --ok:#16a34a;
    }
    *{ box-sizing:border-box; margin:0; padding:0; }
    html{ scroll-behavior:smooth; }
    body{
      background:var(--bg);
      color:var(--text-main);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    /* INTRO LOGO */
    .intro-overlay{
      position:fixed;
      inset:0;
      background:#020617;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
      z-index:9999;
    }
    .intro-logo-circle{
      width:96px; height:96px;
      border-radius:999px;
      background:var(--brand-red);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#ffeb3b;
      font-weight:900;
      font-size:56px;
      box-shadow:0 18px 45px rgba(0,0,0,0.85);
      animation:introPop .7s ease-out;
    }
    .intro-text{
      display:flex;
      flex-direction:column;
      align-items:center;
      text-transform:uppercase;
      letter-spacing:.18em;
    }
    .intro-title{
      font-size:15px;
      font-weight:700;
      color:#e5e7eb;
    }
    .intro-sub{
      margin-top:4px;
      font-size:11px;
      color:#9ca3af;
    }
    @keyframes introPop{
      0%{ transform:scale(.4); opacity:0; }
      60%{ transform:scale(1.08); opacity:1; }
      100%{ transform:scale(1); opacity:1; }
    }

    /* TOP BAR */
    .top-nav{
      position:sticky; top:0; z-index:20;
      background:#111827;
      backdrop-filter:blur(6px);
      border-bottom:1px solid #020617;
    }
    .top-nav-inner{
      max-width:1200px;
      margin:0 auto;
      padding:8px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{ display:flex; align-items:center; gap:10px; }
    .brand-logo{
      width:34px; height:34px;
      border-radius:999px;
      background:var(--brand-red);
      display:flex;
      align-items:center; justify-content:center;
      color:#ffeb3b; font-weight:900; font-size:22px;
      box-shadow:0 4px 10px rgba(0,0,0,0.6);
    }
    .brand-text{ display:flex; flex-direction:column; line-height:1.1; }
    .brand-title{
      font-size:15px; font-weight:700;
      letter-spacing:.12em; text-transform:uppercase;
      color:#f9fafb;
    }
    .brand-sub{
      font-size:11px; color:#9ca3af;
      text-transform:uppercase; letter-spacing:.14em;
    }
    .nav-links{ display:flex; flex-wrap:wrap; gap:8px; }
    .nav-links a{
      text-decoration:none; font-size:14px; font-weight:600;
      color:#e5e7eb;
      background:rgba(15,23,42,0.9);
      padding:6px 12px;
      border-radius:999px;
      border:1px solid #4b5563;
    }
    .nav-links a:hover{
      background:var(--brand-red);
      border-color:var(--brand-red);
      color:#ffffff;
      box-shadow:0 0 0 1px rgba(248,250,252,0.2);
    }

    .page{
      max-width:1200px;
      margin:0 auto 40px;
      padding:20px 18px 40px;
    }

    /* HERO */
    .hero{
      position:relative;
      background:#ffffff;
      border-radius:24px;
      padding:24px 24px 26px;
      border:1px solid #e5e7eb;
      box-shadow:0 12px 30px rgba(15,23,42,0.20);
      overflow:hidden;
      margin-bottom:26px;
    }
    .hero-content{ max-width:620px; position:relative; z-index:1; }
    .hero-badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--brand-red);
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      margin-bottom:6px;
      color:#fef2f2; background:var(--brand-red);
    }
    .hero-title{
      font-size:30px; font-weight:800;
      text-transform:uppercase; letter-spacing:.06em;
      margin-bottom:6px; color:#111827;
    }
    .hero-subtitle{
      font-size:16px;
      color:var(--text-main);
      margin-bottom:10px;
    }
    .hero-bullets{
      font-size:14px;
      color:var(--text-main);
      padding-left:18px;
    }
    .hero-bullets li{ margin-bottom:4px; }
    .hero-watermark{
      position:absolute; right:-40px; bottom:-80px;
      width:280px; height:280px;
      border-radius:50%;
      border:10px solid rgba(183,28,28,0.06);
      display:flex; align-items:center; justify-content:center;
    }
    .hero-watermark span{
      font-size:220px; font-weight:900;
      color:rgba(183,28,28,0.04);
      transform:translateY(10px);
    }

    /* SECCIONES */
    section{ margin-bottom:30px; }
    .section-header{ margin-bottom:14px; }
    .section-title{
      font-size:22px; font-weight:800;
      margin-bottom:2px; color:#111827;
    }
    .section-subtitle{
      font-size:14px;
      color:var(--text-main);
    }

    .grid-3{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:16px;
    }
    .grid-2{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:18px;
    }
    @media(max-width:900px){
      .grid-2,.grid-3{grid-template-columns:1fr;}
    }

    .card{
      background:var(--card-bg);
      border-radius:18px;
      padding:18px 20px;
      border:1px solid var(--border);
      box-shadow:0 6px 20px rgba(15,23,42,0.12);
    }
    .card-title{
      font-size:15px; font-weight:700;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:var(--brand-red);
      margin-bottom:8px;
    }
    .card-value{ font-size:34px; font-weight:800; margin-bottom:4px; }
    .card-value.ok{ color:var(--ok); }
    .card-label{
      font-size:14px;
      color:var(--text-main);
      margin-bottom:6px;
    }
    .card-note{
      font-size:14px;
      color:var(--text-main);
    }

    .chart-card{
      background:var(--card-bg);
      border-radius:18px;
      padding:16px 18px;
      border:1px solid var(--border);
      box-shadow:0 6px 18px rgba(15,23,42,0.10);
    }
    .chart-title{ font-size:15px; font-weight:600; color:var(--brand-red); margin-bottom:2px; }
    .chart-subtitle{
      font-size:13px;
      color:var(--text-main);
      margin-bottom:8px;
    }
    .chart-container{ width:100%; height:300px; }
    canvas{ width:100% !important; height:100% !important; }

    .key-list{
      font-size:14px;
      color:var(--text-main);
      padding-left:18px;
    }
    .key-list li{ margin-bottom:4px; }

    .mini-tag{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      border:1px solid var(--border);
      color:var(--text-main);
      margin-bottom:4px;
    }

    .badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--text-main);
      margin-bottom:6px;
      background:#ffffff;
    }

    /* PANEL DIARIO */
    .daily-layout{
      display:grid;
      grid-template-columns: 1.4fr 1fr;
      gap:18px;
      margin-bottom:22px;
    }
    @media(max-width:900px){
      .daily-layout{ grid-template-columns:1fr; }
    }
    .date-label{
      font-size:14px;
      color:var(--text-main);
      margin-bottom:12px;
      font-weight:600;
    }
    .card-resumen-hoy{ border:2px solid #111827; }

    .kpi{
      padding:12px 14px;
      border-radius:14px;
      border:2px solid #111827;
      background:#ffffff;
    }
    .kpi-label{
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:.10em;
      color:var(--text-main);
      margin-bottom:6px;
      font-weight:700;
    }
    .kpi-value{ font-size:30px; font-weight:800; color:#111827; }
    .kpi-value.ok{ color:#15803d; }
    .kpi-extra{
      font-size:13px;
      color:var(--text-main);
      margin-top:4px;
    }
    .note{
      font-size:13px;
      color:var(--text-main);
      margin-top:6px;
    }

    form{ display:flex; flex-direction:column; gap:10px; }
    label{ font-size:14px; color:var(--text-main); font-weight:500; }
    input[type="number"],input[type="date"]{
      width:100%; padding:8px 10px;
      border-radius:8px;
      border:1px solid var(--border);
      font-size:14px;
    }
    input[type="number"]:focus,input[type="date"]:focus{
      outline:none;
      border-color:var(--brand-red);
      box-shadow:0 0 0 1px rgba(183,28,28,0.25);
    }
    .btn{
      margin-top:6px; padding:9px 12px;
      border-radius:8px;
      border:1px solid var(--brand-red);
      background:var(--brand-red);
      color:#fff;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
    }
    .btn:hover{ background:#7f1d1d; border-color:#7f1d1d; }
    .btn-secondary{
      border-color:#9ca3af;
      background:#e5e7eb;
      color:#111827;
    }
    .btn-secondary:hover{
      background:#d1d5db;
      border-color:#6b7280;
    }
    .small-muted{
      font-size:12px;
      color:var(--text-main);
      margin-top:6px;
    }

    .hist-header{
      display:flex; justify-content:space-between;
      align-items:center; gap:10px; margin-bottom:8px;
    }
    .hist-header-title{
      font-size:14px; font-weight:600;
      text-transform:uppercase; letter-spacing:.08em;
      color:var(--brand-red);
    }
    .hist-desc{
      font-size:12px;
      color:var(--text-main);
    }

    .hist-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    /* TABLA HISTORIAL */
    .hist-table-wrapper{
      max-height:260px;
      overflow-y:auto;
      border-radius:12px;
      border:1px solid #e5e7eb;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      text-align:center;   /* üëâ centramos por defecto */
    }
    th, td{
      border-bottom:1px solid #e5e7eb;
      padding:6px 6px;
    }
    th{
      background:#f3f4f6;
      font-weight:600;
    }
    td.num{
      text-align:center;   /* üëâ n√∫meros centrados */
      font-variant-numeric:tabular-nums;
    }
    td.impact-cell{
      text-align:center;
    }
    tr:nth-child(even) td{
      background:#fafafa;
    }
    .empty-row td{
      text-align:center;
      font-size:12px;
      color:var(--text-main);
    }
    .chk-center{
      text-align:center;
    }

    /* PRINT SOLO HISTORIAL */
    .no-print{ }

    @media print {
      body *{
        visibility:hidden;
      }
      #historial-print, #historial-print *{
        visibility:visible;
      }
      #historial-print{
        position:absolute;
        left:0;
        top:0;
        width:100%;
      }
      .no-print{
        display:none !important;
      }
    }
  
        /* RESUMEN MENSUAL + OBJETIVOS */
    .resumen-mes{
      margin-bottom:28px;
      border:2px solid var(--brand-red);
      box-shadow:0 10px 26px rgba(15,23,42,0.20);
      background:linear-gradient(135deg,#ffffff 0,#fffaf0 45%,#fff5f5 100%);
    }
    .resumen-mes-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      margin-bottom:10px;
    }
    .resumen-mes-tit{
      font-size:20px;
      font-weight:800;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:var(--brand-red);
    }
    .resumen-mes-sub{
      font-size:14px;
      color:var(--text-main);
    }
    .resumen-mes-meta{
      font-size:12px;
      color:var(--text-main);
      text-align:right;
    }
    .resumen-chip{
      display:inline-block;
      padding:3px 9px;
      border-radius:999px;
      background:#fee2e2;
      color:var(--brand-red);
      font-size:10px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.14em;
      margin-bottom:4px;
    }
    .goal-panel{
      margin-top:4px;
    }
    .goal-bar{
      margin-top:6px;
    }
    .goal-track{
      position:relative;
      width:100%;
      height:22px;
      border-radius:999px;
      background:#e5e7eb;
      border:1px solid #d1d5db;
      overflow:hidden;
    }
    .goal-fill{
      position:absolute;
      left:0;
      top:0;
      height:100%;
      background:linear-gradient(90deg,#16a34a,#84cc16);
      border-radius:999px;
    }
    .goal-marker{
      position:absolute;
      top:-8px;
      display:flex;
      flex-direction:column;
      align-items:center;
      font-size:10px;
      color:var(--text-main);
    }
    .goal-marker::before{
      content:"";
      width:0;
      height:30px;
      border-left:1px dashed rgba(55,65,81,0.7);
    }
    .goal-marker span{
      margin-top:-2px;
      background:#ffffff;
      padding:1px 5px;
      border-radius:999px;
      border:1px solid #9ca3af;
    }
    .goal-marker.marker-800{
      left:80%;
      transform:translateX(-50%);
    }
    .goal-marker.marker-1000{
      left:100%;
      transform:translateX(-100%);
    }
    .goal-legend{
      margin-top:6px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size:12px;
      color:var(--text-main);
    }
    .goal-legend span::before{
      margin-right:4px;
    }
    .legend-ok::before{
      content:"‚óè";
      color:#16a34a;
    }
    .legend-ideal::before{
      content:"‚óÜ";
      color:#fbbf24;
    }
    .kpi-resumen-row{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;
      margin-top:12px;
    }
    .kpi-resumen-card{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#ffffff;
    }
    .kpi-resumen-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.10em;
      color:var(--text-main);
      margin-bottom:4px;
      font-weight:700;
    }
    .kpi-resumen-num{
      font-size:26px;
      font-weight:800;
      color:var(--brand-red);
      display:flex;
      align-items:baseline;
      gap:4px;
    }
    .kpi-resumen-trend-up{
      font-size:11px;
      color:#16a34a;
      font-weight:700;
    }
    .kpi-resumen-trend-down{
      font-size:11px;
      color:#b91c1c;
      font-weight:700;
    }
    .kpi-resumen-foot{
      margin-top:2px;
      font-size:12px;
      color:var(--text-main);
    }
    @media(max-width:900px){
      .resumen-mes-header{
        flex-direction:column;
        align-items:flex-start;
      }
      .resumen-mes-meta{
        text-align:left;
      }
      .kpi-resumen-row{
        grid-template-columns:1fr;
      }
    }

      .resumen-mes-meta{
        text-align:left;
      }
      .kpi-resumen-row{
        grid-template-columns:1fr;
      }
    }

  </style>
</head>
<body>

  <!-- INTRO LOGO -->
  <div class="intro-overlay no-print" id="introOverlay">
    <div class="intro-logo-circle">Q</div>
    <div class="intro-text">
      <span class="intro-title">QUIROGA GNC</span>
      <span class="intro-sub">CRPC ¬∑ ESTAD√çSTICAS 2025</span>
    </div>
  </div>

  <!-- NAV -->
  <div class="top-nav no-print">
    <div class="top-nav-inner">
      <div class="brand">
        <div class="brand-logo">Q</div>
        <div class="brand-text">
          <div class="brand-title">QUIROGA GNC</div>
          <div class="brand-sub">CRPC ¬∑ ESTAD√çSTICAS 2025</div>
        </div>
      </div>
      <nav class="nav-links">
        <a href="#presentacion">Presentaci√≥n</a>
        <a href="#hoy">Hoy</a>
        <a href="#resumen">Resumen</a>
        <a href="#cantidades">Cantidades</a>
        <a href="#impacto">Impacto</a>
        <a href="#talleres">Talleres</a>
      </nav>
    </div>
  </div>

  <main class="page">


    <!-- RESUMEN MENSUAL C√ìRDOBA / QUIROGA -->
    <section class="card resumen-mes no-print" id="resumen-mensual">
      <div class="resumen-mes-header">
        <div>
          <div class="resumen-chip">Resumen clave del mes</div>
          <div class="resumen-mes-tit">Resumen mensual ¬∑ C√≥rdoba</div>
          <p class="resumen-mes-sub">
            En noviembre C√≥rdoba cay√≥ un <strong>21,1&nbsp;%</strong> en cilindros,
            pero el CRPC Quiroga cerr√≥ con <strong>891</strong> unidades
            y gan√≥ participaci√≥n dentro de la provincia.
          </p>
        </div>
        <div class="resumen-mes-meta">
          <div><strong>CRPC Quiroga ¬∑ Uso interno</strong></div>
          <div>Objetivos: 800 (m√≠nimo) ¬∑ 1.000 (ideal)</div>
          <div>Datos cerrados al √∫ltimo d√≠a del mes</div>
        </div>
      </div>

      <div class="goal-panel">
        <p class="note" style="margin-top:0;">
          Objetivo ideal: <strong>1.000 cilindros</strong> ¬∑
          objetivo m√≠nimo aceptable: <strong>800 cilindros</strong> ¬∑
          resultado de noviembre: <strong>891 cilindros</strong>.
        </p>
        <div class="goal-bar">
          <div class="goal-track">
            <!-- 891 sobre 1.000 ‚âà 89,1 % -->
            <div class="goal-fill" style="width:89.1%;"></div>
            <div class="goal-marker marker-800"><span>800</span></div>
            <div class="goal-marker marker-1000"><span>1.000</span></div>
          </div>
          <div class="goal-legend">
            <span class="legend-ok">Zona objetivo m√≠nimo (‚â• 800 cilindros)</span>
            <span class="legend-ideal">Objetivo ideal mensual (1.000 cilindros)</span>
          </div>
        </div>
      </div>

      <div class="kpi-resumen-row">
        <article class="kpi-resumen-card">
          <div class="kpi-resumen-label">Cilindros en C√≥rdoba</div>
          <div class="kpi-resumen-num">
            <span>4.769</span>
            <span class="kpi-resumen-trend-down">‚ñº ‚àí21,1&nbsp;%</span>
          </div>
          <div class="kpi-resumen-foot">
            Octubre: 6.048 cilindros.
          </div>
        </article>
        <article class="kpi-resumen-card">
          <div class="kpi-resumen-label">Cilindros en CRPC Quiroga</div>
          <div class="kpi-resumen-num">
            <span>891</span>
            <span class="kpi-resumen-trend-down">‚ñº ‚àí18,9&nbsp;%</span>
          </div>
          <div class="kpi-resumen-foot">
            Octubre: 1.099 cilindros (‚àí208 cilindros vs octubre).
          </div>
        </article>
        <article class="kpi-resumen-card">
          <div class="kpi-resumen-label">Participaci√≥n en C√≥rdoba</div>
          <div class="kpi-resumen-num">
            <span>18,7&nbsp;%</span>
            <span class="kpi-resumen-trend-up">‚ñ≤ +0,5 pts</span>
          </div>
          <div class="kpi-resumen-foot">
            Octubre: 18,2&nbsp;% del total provincial.
          </div>
        </article>
      </div>
    </section>



    <!-- PRESENTACI√ìN EJECUTIVA -->
    <section class="hero no-print" id="presentacion">
      <div class="hero-content">
        <div class="hero-badge">Presentaci√≥n</div>
        <h1 class="hero-title">CRPC & Obleas ¬∑ C√≥rdoba 2025</h1>
        <p class="hero-subtitle">
          Situaci√≥n del a√±o en una sola vista:
        </p>
        <ul class="hero-bullets">
          <li><strong>8.300 cilindros</strong> procesados en el CRPC (10 meses).</li>
          <li>Participaci√≥n promedio: <strong>16 %</strong> de los cilindros y <strong>11 %</strong> de las obleas de C√≥rdoba.</li>
          <li>Meses pico claros y concentraci√≥n en pocos talleres.</li>
        </ul>
      </div>
      <div class="hero-watermark">
        <span>Q</span>
      </div>
    </section>

    <!-- PANEL DIARIO ONLINE -->
    <section id="hoy">
      <header class="section-header no-print">
        <div class="badge">Impacto diario online</div>
        <h2 class="section-title">Quiroga CRPC vs C√≥rdoba ‚Äì √öltimo dato cargado</h2>
        <p class="section-subtitle">
          Se muestra el √∫ltimo d√≠a con datos cargados (normalmente el d√≠a anterior).
        </p>
      </header>

      <div class="daily-layout no-print">
        <!-- Resumen -->
        <section class="card card-resumen-hoy">
          <div class="card-title">Resumen de √∫ltimo d√≠a cargado</div>
          <div class="date-label" id="lblFecha"></div>

          <div class="grid-3">
            <div class="kpi">
              <div class="kpi-label">C√≥rdoba</div>
              <div class="kpi-value" id="kpiCordoba">0</div>
              <div class="kpi-extra">Cilindros hechos en C√≥rdoba.</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Quiroga CRPC</div>
              <div class="kpi-value" id="kpiQuiroga">0</div>
              <div class="kpi-extra">Cilindros procesados en el CRPC.</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Impacto</div>
              <div class="kpi-value ok" id="kpiImpacto">0%</div>
              <div class="kpi-extra">Porcentaje de C√≥rdoba que pasa por el CRPC.</div>
            </div>
          </div>

          <p class="note">
            F√≥rmula: <strong>Impacto = (Quiroga / C√≥rdoba) √ó 100</strong>.  
            Si C√≥rdoba es 0, se muestra ‚Äú‚Äì‚Äù.
          </p>
        </section>

        <!-- Formulario -->
        <section class="card">
          <div class="card-title">Cargar datos del d√≠a</div>
          <p class="date-label" id="lblFechaForm"></p>

          <form id="formImpacto">
            <div>
              <label for="inpFecha">Fecha de los datos</label>
              <input type="date" id="inpFecha">
            </div>

            <div>
              <label for="inpCordoba">Cilindros hechos en C√≥rdoba</label>
              <input type="number" id="inpCordoba" min="0" step="1" placeholder="Ej: 200">
            </div>

            <div>
              <label for="inpQuiroga">Cilindros hechos en Quiroga CRPC</label>
              <input type="number" id="inpQuiroga" min="0" step="1" placeholder="Ej: 70">
            </div>

            <button class="btn" type="submit">Guardar / agregar d√≠a</button>

            <div class="small-muted">
              Pod√©s cambiar la fecha antes de guardar.  
              Si te equivoc√°s, borr√°s la fila y recarg√°s con la fecha correcta.
            </div>
          </form>
        </section>
      </div>

      <!-- Historial (√∫nico que se imprime) -->
      <section class="card" id="historial-print">
        <div class="hist-header">
          <div>
            <div class="hist-header-title">Historial de d√≠as guardados (online)</div>
            <div class="hist-desc">
              Datos guardados en Firestore. Se muestra un registro por guardado.
            </div>
          </div>
          <div class="hist-actions no-print">
            <button type="button" class="btn btn-secondary" id="btnImprimirHistorial">
              Imprimir
            </button>
            <button type="button" class="btn btn-secondary" id="btnBorrarSeleccionados">
              Borrar seleccionados
            </button>
          </div>
        </div>

        <div class="hist-table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>C√≥rdoba</th>
                <th>Quiroga</th>
                <th>Impacto %</th>
                <th>Sel.</th>
              </tr>
            </thead>
            <tbody id="tbodyHistorial">
            </tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- RESUMEN ANUAL -->
    <section id="resumen" class="no-print">
      <header class="section-header">
        <h2 class="section-title">1. Resumen anual</h2>
        <p class="section-subtitle">
          Totales del a√±o y lectura r√°pida por tipo de dato.
        </p>
      </header>

      <div class="grid-3" style="margin-bottom:16px;">
        <article class="card">
          <div class="card-title">CRPC ‚Äì cilindros 2025</div>
          <div class="card-value">8.300</div>
          <div class="card-label">Cilindros procesados en 10 meses.</div>
        </article>
        <article class="card">
          <div class="card-title">Obleas Quirgroup</div>
          <div class="card-value">3.920</div>
          <div class="card-label">Obleas emitidas por Quirgroup en el a√±o.</div>
        </article>
        <article class="card">
          <div class="card-title">Obleas Quiroga</div>
          <div class="card-value">18.672</div>
          <div class="card-label">Obleas emitidas por Quiroga en el a√±o.</div>
        </article>
      </div>

      <div class="grid-3">
        <article class="card">
          <div class="card-title">ULTIMO MES-OCTUBRE</div>
          <div class="card-value ok">
            ‚ñ≤+18%
          </div>
          <div class="card-label">Variaci√≥n de cilindros totales procesados.</div>
        </article>
        <article class="card">
          <div class="card-title">Impacto CRPC en C√≥rdoba</div>
          <div class="card-value">16%</div>
          <div class="card-label">Participaci√≥n promedio del a√±o.</div>
          <div class="card-note">
            De cada 100 cilindros de C√≥rdoba, unos 16 pasan por el CRPC.
          </div>
        </article>
        <article class="card">
          <div class="card-title">Impacto obleas del taller</div>
          <div class="card-value">11%</div>
          <div class="card-label">Quiroga + Quirgroup sobre obleas de C√≥rdoba.</div>
          <div class="card-note">
            De cada 100 obleas de la provincia, unas 11 salen del taller.
          </div>
        </article>
      </div>
    </section>

    <!-- CANTIDADES MENSUALES -->
    <section id="cantidades" class="no-print">
      <header class="section-header">
        <h2 class="section-title">2. Cantidades mensuales</h2>
        <p class="section-subtitle">
          Barras simples: un gr√°fico para cilindros y otro para obleas.
        </p>
      </header>

      <div class="grid-2">
        <article class="chart-card">
          <div class="chart-title">CRPC por mes</div>
          <div class="chart-subtitle">Cilindros procesados en el CRPC.</div>
          <div class="chart-container">
            <canvas id="chartCrpcMes"></canvas>
          </div>
        </article>

        <article class="chart-card">
          <div class="chart-title">Obleas por mes</div>
          <div class="chart-subtitle">Obleas totales del taller (Quiroga + Quirgroup).</div>
          <div class="chart-container">
            <canvas id="chartObleasMes"></canvas>
          </div>
        </article>
      </div>

      <article class="card" style="margin-top:16px;">
        <div class="card-title">Lectura r√°pida</div>
        <ul class="key-list">
          <li><strong>Picos de CRPC:</strong> Julio (1.027) y Octubre (1.099).</li>
          <li><strong>Mes m√°s bajo CRPC:</strong> Marzo (557 cilindros).</li>
          <li>Las obleas mantienen vol√∫menes acordes a los meses de mayor actividad.</li>
        </ul>
      </article>
    </section>

    <!-- IMPACTO MENSUAL -->
    <section id="impacto" class="no-print">
      <header class="section-header">
        <h2 class="section-title">3. Impacto mensual en C√≥rdoba</h2>
        <p class="section-subtitle">
          Qu√© porcentaje representamos del total de la provincia, mes a mes.
        </p>
      </header>

      <div class="grid-2">
        <article class="chart-card">
          <div class="chart-title">Impacto CRPC (%)</div>
          <div class="chart-subtitle">
            Porcentaje de cilindros de Quiroga sobre el total de C√≥rdoba.
          </div>
          <div class="chart-container">
            <canvas id="chartImpactCrpc"></canvas>
          </div>
        </article>

        <article class="chart-card">
          <div class="chart-title">Impacto obleas (%)</div>
          <div class="chart-subtitle">
            Porcentaje de obleas del taller sobre el total de obleas de C√≥rdoba.
          </div>
          <div class="chart-container">
            <canvas id="chartImpactObleas"></canvas>
          </div>
        </article>
      </div>

      <article class="card" style="margin-top:16px;">
        <div class="card-title">Lectura r√°pida</div>
        <ul class="key-list">
          <li>CRPC casi siempre entre <strong>15‚Äì16 %</strong>, m√°ximo 18 % en octubre.</li>
          <li>Obleas entre <strong>10‚Äì12 %</strong> seg√∫n el mes.</li>
        </ul>
      </article>
    </section>

    <!-- TALLERES - EN DESARROLLO -->
    <section id="talleres" class="no-print">
      <header class="section-header">
        <h2 class="section-title">4. Talleres que m√°s aportan</h2>
        <p class="section-subtitle">
          M√≥dulo en desarrollo: ac√° va a ir el ranking detallado de talleres.
        </p>
      </header>

      <article class="card">
        <div class="card-title">M√≥dulo en desarrollo</div>
        <p class="card-note">
          Pr√≥xima etapa: ranking completo de talleres, vol√∫menes de cilindros enviados al CRPC
          y filtros para comparar rendimiento por zona y per√≠odo.
        </p>
      </article>
    </section>

  </main>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAq1_VIg5BtPH9QPS5NwuJDrVCqyfQ3qwU",
      authDomain: "estadisticas-diarias.firebaseapp.com",
      databaseURL: "https://estadisticas-diarias-default-rtdb.firebaseio.com",
      projectId: "estadisticas-diarias",
      storageBucket: "estadisticas-diarias.firebasestorage.app",
      messagingSenderId: "952047688138",
      appId: "1:952047688138:web:5e01162214f6ee7bd71733",
      measurementId: "G-BD9QD9241G"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const COLLECTION_NAME = "impacto_diario";
    let registros = [];

    function getHoyISO(){
      const hoy = new Date();
      return hoy.toISOString().slice(0,10);
    }

    function formatFechaISO(fechaISO){
      const partes = fechaISO.split("-");
      if(partes.length !== 3) return fechaISO;
      const [y,m,d] = partes;
      return d + "/" + m + "/" + y;
    }

    function calcularImpacto(cordoba, quiroga){
      if(cordoba <= 0) return null;
      return (quiroga / cordoba) * 100;
    }

    function cargarRegistros(){
      db.collection(COLLECTION_NAME)
        .orderBy("fecha", "desc")
        .get()
        .then(snapshot => {
          registros = [];
          snapshot.forEach(doc => {
            const data = doc.data();
            registros.push({
              docId: doc.id,
              fecha: data.fecha,
              cordoba: data.cordoba || 0,
              quiroga: data.quiroga || 0,
              createdAt: data.createdAt || null
            });
          });
          renderTodo();
        })
        .catch(err => {
          alert("Error leyendo Firestore: " + err.message);
          console.error("Error al leer Firestore", err);
        });
    }

    function obtenerUltimoRegistro(){
      if(registros.length === 0) return null;
      return registros[0];
    }

    function renderResumen(){
      const lblFecha = document.getElementById("lblFecha");
      const lblFechaForm = document.getElementById("lblFechaForm");
      const kpiCordoba = document.getElementById("kpiCordoba");
      const kpiQuiroga = document.getElementById("kpiQuiroga");
      const kpiImpacto = document.getElementById("kpiImpacto");
      const inpCordoba = document.getElementById("inpCordoba");
      const inpQuiroga = document.getElementById("inpQuiroga");
      const inpFecha = document.getElementById("inpFecha");

      const hoyISO = getHoyISO();
      const ultimo = obtenerUltimoRegistro();

      let cordoba = 0;
      let quiroga = 0;

      if(ultimo){
        cordoba = ultimo.cordoba || 0;
        quiroga = ultimo.quiroga || 0;
        lblFecha.textContent = "√öltimo d√≠a cargado: " + formatFechaISO(ultimo.fecha);
      }else{
        lblFecha.textContent = "Sin datos cargados todav√≠a.";
      }

      lblFechaForm.textContent = "Seleccion√° la fecha de los datos (por defecto hoy).";

      if(!inpFecha.value){
        inpFecha.value = hoyISO;
      }

      kpiCordoba.textContent = cordoba;
      kpiQuiroga.textContent = quiroga;

      const impacto = calcularImpacto(cordoba, quiroga);
      kpiImpacto.textContent = (impacto === null)
        ? "‚Äì"
        : impacto.toFixed(1).replace(".",",") + "%";

      inpCordoba.value = "";
      inpQuiroga.value = "";
    }

    function renderTabla(){
      const tbody = document.getElementById("tbodyHistorial");
      tbody.innerHTML = "";

      if(registros.length === 0){
        const trVacio = document.createElement("tr");
        trVacio.classList.add("empty-row");
        const tdVacio = document.createElement("td");
        tdVacio.colSpan = 5;
        tdVacio.textContent = "Sin registros guardados.";
        trVacio.appendChild(tdVacio);
        tbody.appendChild(trVacio);
        return;
      }

      registros.forEach(reg => {
        const tr = document.createElement("tr");

        const tdFecha = document.createElement("td");
        tdFecha.textContent = formatFechaISO(reg.fecha);
        tr.appendChild(tdFecha);

        const tdCordoba = document.createElement("td");
        tdCordoba.classList.add("num");
        tdCordoba.textContent = reg.cordoba || 0;
        tr.appendChild(tdCordoba);

        const tdQuiroga = document.createElement("td");
        tdQuiroga.classList.add("num");
        tdQuiroga.textContent = reg.quiroga || 0;
        tr.appendChild(tdQuiroga);

        const tdImpacto = document.createElement("td");
        tdImpacto.classList.add("impact-cell");
        const imp = calcularImpacto(reg.cordoba, reg.quiroga);
        tdImpacto.textContent = (imp === null)
          ? "‚Äì"
          : imp.toFixed(1).replace(".",",") + "%";
        tr.appendChild(tdImpacto);

        const tdSel = document.createElement("td");
        tdSel.classList.add("chk-center");
        const chk = document.createElement("input");
        chk.type = "checkbox";
        chk.classList.add("fila-check");
        chk.dataset.id = reg.docId;
        tdSel.appendChild(chk);
        tr.appendChild(tdSel);

        tbody.appendChild(tr);
      });
    }

    function renderTodo(){
      renderResumen();
      renderTabla();
    }

    document.getElementById("formImpacto").addEventListener("submit", e => {
      e.preventDefault();

      const inpCordoba = document.getElementById("inpCordoba");
      const inpQuiroga = document.getElementById("inpQuiroga");
      const inpFecha = document.getElementById("inpFecha");

      const cordoba = parseInt(inpCordoba.value, 10) || 0;
      const quiroga = parseInt(inpQuiroga.value, 10) || 0;
      const fecha = inpFecha.value || getHoyISO();

      db.collection(COLLECTION_NAME).add({
        fecha,
        cordoba,
        quiroga,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        alert("Guardado en Firebase OK");
        inpCordoba.value = "";
        inpQuiroga.value = "";
        cargarRegistros();
      })
      .catch(err => {
        alert("Error al guardar en Firestore: " + err.message);
        console.error("Error al guardar en Firestore", err);
      });
    });

    document.getElementById("btnBorrarSeleccionados").addEventListener("click", () => {
      const checks = document.querySelectorAll(".fila-check:checked");
      if(checks.length === 0) return;

      const ids = Array.from(checks).map(chk => chk.dataset.id);
      const batch = db.batch();

      ids.forEach(id => {
        const ref = db.collection(COLLECTION_NAME).doc(id);
        batch.delete(ref);
      });

      batch.commit()
        .then(() => cargarRegistros())
        .catch(err => {
          alert("Error borrando registros: " + err.message);
          console.error("Error borrando registros", err);
        });
    });

    // Imprimir solo historial
    document.getElementById("btnImprimirHistorial").addEventListener("click", () => {
      window.print();
    });

    // Intro: ocultar despu√©s de un ratito
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => {
        const intro = document.getElementById("introOverlay");
        if(intro){ intro.style.display = "none"; }
      }, 1600);
    });

    window.addEventListener("load", () => {
      cargarRegistros();
    });
  </script>

  <script>
    // CHARTS (presentaci√≥n fija de ejemplo)
    const labelsMeses = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct'];
    const dataCRPC  = [947,655,557,692,660,777,1027,931,955,1099];
    const dataObleasTotales = [2586,1571,1926,2179,2049,2096,2600,2535,2505,2545];
    const impactoCRPC   = [16,14,13,15,16,16,15,16,16,18];
    const impactoObleas = [13,10,11,11,11,11,12,12,12,12];

    const valueLabelsPlugin = {
      id: 'valueLabels',
      afterDatasetsDraw(chart){
        const {ctx} = chart;
        const isImpactChart =
          chart.canvas &&
          (chart.canvas.id === 'chartImpactCrpc' ||
           chart.canvas.id === 'chartImpactObleas');

        chart.data.datasets.forEach((dataset, datasetIndex) => {
          const meta = chart.getDatasetMeta(datasetIndex);
          if (meta.hidden) return;
          meta.data.forEach((el, index) => {
            const value = dataset.data[index];
            if (value == null) return;

            const text = isImpactChart ? value + '%' : value;
            ctx.save();
            ctx.fillStyle = '#111827';
            ctx.font = 'bold 12px system-ui';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'bottom';

            if (chart.options.indexAxis === 'y') {
              const x = el.x + 8;
              const y = el.y + 4;
              ctx.textAlign = 'left';
              ctx.textBaseline = 'middle';
              ctx.fillText(text, x, y);
            } else {
              const x = el.x;
              const y = el.y - 3;
              ctx.fillText(text, x, y);
            }
            ctx.restore();
          });
        });
      }
    };

    new Chart(document.getElementById('chartCrpcMes'), {
      type:'bar',
      data:{ labels:labelsMeses, datasets:[{
        label:'CRPC',
        data:dataCRPC,
        backgroundColor:'rgba(17,24,39,0.9)',
        borderRadius:8,
        barThickness:26,
        maxBarThickness:32
      }]},
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{ display:false },
          tooltip:{ callbacks:{ label:ctx=>` ${ctx.parsed.y} cilindros` } }
        },
        scales:{
          x:{ grid:{ display:false }, ticks:{ font:{ size:13, weight:'600' } } },
          y:{ beginAtZero:true, grid:{ color:'rgba(148,163,184,0.3)' }, ticks:{ font:{ size:11 } } }
        }
      },
      plugins:[valueLabelsPlugin]
    });

    new Chart(document.getElementById('chartObleasMes'), {
      type:'bar',
      data:{ labels:labelsMeses, datasets:[{
        label:'Obleas (Q+QG)',
        data:dataObleasTotales,
        backgroundColor:'rgba(183,28,28,0.9)',
        borderRadius:8,
        barThickness:26,
        maxBarThickness:32
      }]},
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{ display:false },
          tooltip:{ callbacks:{ label:ctx=>` ${ctx.parsed.y} obleas` } }
        },
        scales:{
          x:{ grid:{ display:false }, ticks:{ font:{ size:13, weight:'600' } } },
          y:{ beginAtZero:true, grid:{ color:'rgba(148,163,184,0.3)' }, ticks:{ font:{ size:11 } } }
        }
      },
      plugins:[valueLabelsPlugin]
    });

    new Chart(document.getElementById('chartImpactCrpc'), {
      type:'bar',
      data:{ labels:labelsMeses, datasets:[{
        label:'Impacto CRPC %',
        data:impactoCRPC,
        backgroundColor:'rgba(21,101,192,0.9)',
        borderRadius:8,
        barThickness:24,
        maxBarThickness:30
      }]},
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{ display:false },
          tooltip:{ callbacks:{ label:ctx=>` ${ctx.parsed.y}%` } }
        },
        scales:{
          x:{ grid:{ display:false }, ticks:{ font:{ size:13, weight:'600' } } },
          y:{ beginAtZero:true, max:20, grid:{ color:'rgba(148,163,184,0.3)' }, ticks:{ font:{ size:11 } } }
        }
      },
      plugins:[valueLabelsPlugin]
    });

    new Chart(document.getElementById('chartImpactObleas'), {
      type:'bar',
      data:{ labels:labelsMeses, datasets:[{
        label:'Impacto obleas %',
        data:impactoObleas,
        backgroundColor:'rgba(183,28,28,0.9)',
        borderRadius:8,
        barThickness:24,
        maxBarThickness:30
      }]},
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{ display:false },
          tooltip:{ callbacks:{ label:ctx=>` ${ctx.parsed.y}%` } }
        },
        scales:{
          x:{ grid:{ display:false }, ticks:{ font:{ size:13, weight:'600' } } },
          y:{ beginAtZero:true, max:20, grid:{ color:'rgba(148,163,184,0.3)' }, ticks:{ font:{ size:11 } } }
        }
      },
      plugins:[valueLabelsPlugin]
    });
  </script>

</body>
</html>
